<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Introduction to metaconfoundr • metaconfoundr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An Introduction to metaconfoundr">
<meta property="og:description" content="metaconfoundr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metaconfoundr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro-to-metaconfoundr.html">An Introduction to metaconfoundr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/malcolmbarrett/metaconfoundr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro-to-metaconfoundr_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An Introduction to metaconfoundr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/malcolmbarrett/metaconfoundr/blob/master/vignettes/intro-to-metaconfoundr.Rmd"><code>vignettes/intro-to-metaconfoundr.Rmd</code></a></small>
      <div class="hidden name"><code>intro-to-metaconfoundr.Rmd</code></div>

    </div>

    
    
<p>The metaconfoundr package is a toolkit for visualizing confounding control in a set of studies included in a meta-analysis. In this approach, a set of domain experts agree on the variables required to control for confounding for a scientific question properly. Then, for a given confounder, the studies are described as being adequately controlled, inadequately controlled, or controlled with some concerns (see the vignette on evaluating studies and setting up your data). metaconfoundr visualizes these relationships using heatmaps and traffic light plots. <code><a href="../reference/metaconfoundr().html">metaconfoundr()</a></code> standardizes data for use in <code><a href="../reference/mc_heatmap.html">mc_heatmap()</a></code> and <code><a href="../reference/mc_heatmap.html">mc_trafficlight()</a></code>. Let’s look at an example with an included data set, <code>ipi</code>. These data represent 14 analyses (retrospective cohorts and sibling-matched designs) to evaluate the association between short interpregnancy interval (&lt;6 months versus 18-23 months) and risk of preterm birth (&lt;37 weeks gestation) and the adequacy of confounder control. Using <code><a href="../reference/metaconfoundr().html">metaconfoundr()</a></code> on <code>ipi</code> does some data wrangling to get it into a shape expected by the plotting functions:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/malcolmbarrett/metaconfoundr">metaconfoundr</a></span>)

<span class="co"># for later examples</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>, warn.conflicts = <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)

<span class="fu"><a href="../reference/metaconfoundr().html">metaconfoundr</a></span>(<span class="kw">ipi</span>)
<span class="co">#&gt; # A tibble: 540 x 5</span>
<span class="co">#&gt;    construct         variable     is_confounder study    control_quality</span>
<span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;        &lt;chr&gt;         &lt;chr&gt;    &lt;ord&gt;          </span>
<span class="co">#&gt;  1 Sociodemographics Maternal age Y             study_1  adequate       </span>
<span class="co">#&gt;  2 Sociodemographics Maternal age Y             study_2  some concerns  </span>
<span class="co">#&gt;  3 Sociodemographics Maternal age Y             study_3  some concerns  </span>
<span class="co">#&gt;  4 Sociodemographics Maternal age Y             study_4  adequate       </span>
<span class="co">#&gt;  5 Sociodemographics Maternal age Y             study_5  adequate       </span>
<span class="co">#&gt;  6 Sociodemographics Maternal age Y             study_6  adequate       </span>
<span class="co">#&gt;  7 Sociodemographics Maternal age Y             study_7  some concerns  </span>
<span class="co">#&gt;  8 Sociodemographics Maternal age Y             study_8  some concerns  </span>
<span class="co">#&gt;  9 Sociodemographics Maternal age Y             study_9  some concerns  </span>
<span class="co">#&gt; 10 Sociodemographics Maternal age Y             study_10 some concerns  </span>
<span class="co">#&gt; # … with 530 more rows</span>
</pre></div>
<p>The vignette on evaluating studies has more detail, but in brief, the goal is to create a data frame where there are five columns and a row for each confounder and study. The columns are <code>construct</code>, the domain to which a confounder might belong (e.g., “Sociodemographics”); <code>variable</code>, the name of the variable (e.g. “age”); <code>is_confounder</code>, an indicator if the variable is a confounder; <code>study</code>, the name of the study (or another unique ID); and <code>control_quality</code>, an indicator of the level of control for a confounder. <code>control_quality</code> is one of “adequate”, “some concerns”, or “inadequate”. metaconfoundr attempts to automatically detect the layout of your data, but you have full control (see <code><a href="../reference/mc_detect_layout.html">?mc_detect_layout</a></code>). You can also specify the data in this format manually.</p>
<p>Data that you provide <code><a href="../reference/metaconfoundr().html">metaconfoundr()</a></code> can be in two basic formats: a long and wide. With the long format, metaconfoundr assumes that five columns match the above layout and standardizes them. If there are more than five, <code><a href="../reference/metaconfoundr().html">metaconfoundr()</a></code> treats any additional columns as studies, (e.g., they are in wide format). It will automatically transform your wide data to the format expected by metaconfoundr plotting functions. <code>ipi</code> has a wide cousin, <code>ipi_wide</code>, which <code><a href="../reference/metaconfoundr().html">metaconfoundr()</a></code> can prepare seamlessly:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">ipi_wide</span>
<span class="co">#&gt; # A tibble: 36 x 18</span>
<span class="co">#&gt;    construct factor confounder_y_n study_1 study_2 study_3 study_4 study_5</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Sociodem… Mater… Y                    2       1       1       2       2</span>
<span class="co">#&gt;  2 Sociodem… Pater… Y                    0       0       0       0       0</span>
<span class="co">#&gt;  3 Sociodem… Race/… Y                    1       1       1       1       1</span>
<span class="co">#&gt;  4 Sociodem… Marit… Y                    2       2       2       1       1</span>
<span class="co">#&gt;  5 Sociodem… pater… Y                    0       0       0       0       0</span>
<span class="co">#&gt;  6 Sociodem… Geogr… Y                    0       0       0       0       0</span>
<span class="co">#&gt;  7 Socioeco… SES c… Y                    2       1       2       0       0</span>
<span class="co">#&gt;  8 Socioeco… Incom… Y                    0       0       0       0       0</span>
<span class="co">#&gt;  9 Socioeco… Educa… Y                    2       2       1       1       1</span>
<span class="co">#&gt; 10 Socioeco… Insur… Y                    0       0       0       0       0</span>
<span class="co">#&gt; # … with 26 more rows, and 10 more variables: study_6 &lt;dbl&gt;, study_7 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   study_8 &lt;dbl&gt;, study_9 &lt;dbl&gt;, study_10 &lt;dbl&gt;, study_11 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   study_12 &lt;dbl&gt;, study_13 &lt;dbl&gt;, study_14 &lt;dbl&gt;, study_15 &lt;dbl&gt;</span>

<span class="fu"><a href="../reference/metaconfoundr().html">metaconfoundr</a></span>(<span class="kw">ipi_wide</span>)
<span class="co">#&gt; # A tibble: 540 x 5</span>
<span class="co">#&gt;    construct         variable     is_confounder study    control_quality</span>
<span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;        &lt;chr&gt;         &lt;chr&gt;    &lt;ord&gt;          </span>
<span class="co">#&gt;  1 Sociodemographics Maternal age Y             study_1  adequate       </span>
<span class="co">#&gt;  2 Sociodemographics Maternal age Y             study_2  some concerns  </span>
<span class="co">#&gt;  3 Sociodemographics Maternal age Y             study_3  some concerns  </span>
<span class="co">#&gt;  4 Sociodemographics Maternal age Y             study_4  adequate       </span>
<span class="co">#&gt;  5 Sociodemographics Maternal age Y             study_5  adequate       </span>
<span class="co">#&gt;  6 Sociodemographics Maternal age Y             study_6  adequate       </span>
<span class="co">#&gt;  7 Sociodemographics Maternal age Y             study_7  some concerns  </span>
<span class="co">#&gt;  8 Sociodemographics Maternal age Y             study_8  some concerns  </span>
<span class="co">#&gt;  9 Sociodemographics Maternal age Y             study_9  some concerns  </span>
<span class="co">#&gt; 10 Sociodemographics Maternal age Y             study_10 some concerns  </span>
<span class="co">#&gt; # … with 530 more rows</span>
</pre></div>
<div id="creating-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-plots" class="anchor"></a>Creating plots</h1>
<p>The primary goal of metaconfoundr is to visualize confounding control for a set of studies in a meta-analysis. The two main plotting functions are <code><a href="../reference/mc_heatmap.html">mc_heatmap()</a></code> and <code><a href="../reference/mc_heatmap.html">mc_trafficlight()</a></code>, which both accept data prepared by <code><a href="../reference/metaconfoundr().html">metaconfoundr()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">mc_ipi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metaconfoundr().html">metaconfoundr</a></span>(<span class="kw">ipi</span>)
</pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="../reference/mc_heatmap.html">mc_heatmap</a></span>(<span class="kw">mc_ipi</span>)
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-4-1.png" width="1152"></p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="../reference/mc_heatmap.html">mc_trafficlight</a></span>(<span class="kw">mc_ipi</span>)
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-5-1.png" width="1152"></p>
<div id="customizing-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#customizing-plots" class="anchor"></a>Customizing plots</h2>
<p>These results are ggplots and can thus be customized like any other plot from ggplot2.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">wrap_labeller</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">x</span>) <span class="kw">stringr</span>::<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span>(<span class="kw">x</span>, <span class="fl">10</span>)

<span class="fu"><a href="../reference/mc_heatmap.html">mc_heatmap</a></span>(<span class="kw">mc_ipi</span>) <span class="op">+</span> 
  <span class="fu"><a href="../reference/facet_constructs.html">facet_constructs</a></span>(labeller = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span>(<span class="kw">wrap_labeller</span>)) <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_mc.html">theme_mc</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(
    axis.text.x = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(angle = <span class="fl">90</span>, hjust = <span class="fl">1</span>, vjust = <span class="fl">.5</span>),
    strip.text = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(face = <span class="st">"bold"</span>)
  )
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-6-1.png" width="1152"></p>
<p>metaconfoundr also supports adding Cochrane-like symbols and colors to plots with geoms and scales. Note that these colors are <em>not</em> colorblind-friendly.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="../reference/mc_heatmap.html">mc_trafficlight</a></span>(<span class="kw">mc_ipi</span>) <span class="op">+</span> 
  <span class="fu"><a href="../reference/geom_cochrane.html">geom_cochrane</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="../reference/scale_fill_cochrane.html">scale_fill_cochrane</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_mc.html">theme_mc</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(x = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html">guide_axis</a></span>(n.dodge = <span class="fl">3</span>)) <span class="co"># dodge axis text rather than rotate</span>
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-7-1.png" width="1152"></p>
<p>It’s also possible to sort plots by how well a confounder is controlled over all the studies included. See <code><a href="../reference/score_control.html">?score_control</a></code> for more information on available algorithms by which to sort confounders.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="../reference/mc_heatmap.html">mc_heatmap</a></span>(<span class="kw">mc_ipi</span>, sort = <span class="fl">TRUE</span>) <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_mc.html">theme_mc</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(axis.text.x = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(angle = <span class="fl">90</span>, hjust = <span class="fl">1</span>, vjust = <span class="fl">.5</span>),)
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-8-1.png" width="1152"></p>
</div>
<div id="summarizing-confounder-control" class="section level2">
<h2 class="hasAnchor">
<a href="#summarizing-confounder-control" class="anchor"></a>Summarizing confounder control</h2>
<p>In addition to visualizing all possible confounders, metaconfoundr supports evaluating confounders at the domain level. For instance, if we feel <code>ipi</code> has three core areas of confounding, we can specify what variables are necessary for adequate control to account for the domain. These three domains are sociodemographics, socioeconomics, and reproductive history. We’ll say that controlling for maternal age, race/ethnicity, and marital status are sufficient to control for sociodemographics; socioeconomic status <em>or</em> insurance status <em>and</em> education are adequate for socioeconomics; and prior pregnancy outcomes are enough to control for reproductive history. We can specify these rules using boolean logic that refers to confounders in the <code>variable</code> column of our data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">summary_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_control_quality.html">summarize_control_quality</a></span>(
  <span class="fu"><a href="../reference/metaconfoundr().html">metaconfoundr</a></span>(<span class="kw">ipi</span>),
  Sociodemographics = <span class="kw">`Maternal age`</span> <span class="op">&amp;</span> <span class="kw">`Race/ethnicity`</span> <span class="op">&amp;</span> <span class="kw">`Marital status`</span>,
  Socioeconomics = <span class="kw">`SES category`</span> <span class="op">|</span> <span class="kw">Insurance</span> <span class="op">&amp;</span> <span class="kw">Education</span>,
  <span class="st">"Reproductive Hx"</span> = <span class="kw">`Prior pregnancy outcome`</span>
)

<span class="kw">summary_df</span>
<span class="co">#&gt; # A tibble: 60 x 4</span>
<span class="co">#&gt;    study   variable          control_quality construct</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;fct&gt;             &lt;ord&gt;           &lt;fct&gt;    </span>
<span class="co">#&gt;  1 study_1 overall           some concerns   overall  </span>
<span class="co">#&gt;  2 study_1 Sociodemographics inadequate      domains  </span>
<span class="co">#&gt;  3 study_1 Socioeconomics    adequate        domains  </span>
<span class="co">#&gt;  4 study_1 Reproductive Hx   inadequate      domains  </span>
<span class="co">#&gt;  5 study_2 overall           some concerns   overall  </span>
<span class="co">#&gt;  6 study_2 Sociodemographics inadequate      domains  </span>
<span class="co">#&gt;  7 study_2 Socioeconomics    some concerns   domains  </span>
<span class="co">#&gt;  8 study_2 Reproductive Hx   inadequate      domains  </span>
<span class="co">#&gt;  9 study_3 overall           some concerns   overall  </span>
<span class="co">#&gt; 10 study_3 Sociodemographics inadequate      domains  </span>
<span class="co">#&gt; # … with 50 more rows</span>
</pre></div>
<p>Summarizing control quality creates a more straightforward visualization. You can also visualize just the overall control quality of a study by using the <code>domains = FALSE</code> argument in <code><a href="../reference/summarize_control_quality.html">summarize_control_quality()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="../reference/mc_heatmap.html">mc_heatmap</a></span>(<span class="kw">summary_df</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/theme_mc.html">theme_mc</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(legend.position = <span class="st">"right"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(x = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html">guide_axis</a></span>(n.dodge = <span class="fl">2</span>))
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-10-1.png" width="480"></p>
</div>
</div>
<div id="combining-with-forest-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#combining-with-forest-plots" class="anchor"></a>Combining with forest plots</h1>
<p>Because metaconfoundr plots are ggplots, it’s easy to combine with other plots using tools from the ggplot2 ecosystem. The patchwork package makes it particularly easy, allowing you to connect plots with <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>. For example, let’s make a simple forest plot in ggplot2 and combine it with a metaconfoundr plot. (Alternatively, you could use a tool like <a href="https://github.com/malcolmbarrett/tidymeta">tidymeta</a> to create the forest plot.) <code>ipi_metaanalysis</code> contains effect sizes for the studies in <code>ipi</code>. We’ll also write a helper function, <code>sort_by_year()</code>, to help order the two plots in the same way.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">sort_by_year</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">.df</span>) {
  <span class="kw">.df</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span>(<span class="kw">year</span>)) <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      study = <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">lead_author</span>, <span class="st">" "</span>, <span class="kw">year</span>, <span class="st">" ("</span>, <span class="kw">design</span>, <span class="st">")"</span>),
      study = <span class="kw">forcats</span>::<span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span>(<span class="kw">study</span>)
    )
}

<span class="kw">forest_plot</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">.df</span>) {
   <span class="kw">.df</span> <span class="op">%&gt;%</span> 
    <span class="fu">sort_by_year</span>() <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">estimate</span>, y = <span class="kw">study</span>)) <span class="op">+</span> 
    <span class="co">#  add effect estimates</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(size = <span class="kw">sample_size</span>), shape = <span class="fl">15</span>) <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html">geom_errorbarh</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(xmin = <span class="kw">lower_ci</span>, xmax = <span class="kw">upper_ci</span>), height = <span class="fl">0</span>) <span class="op">+</span> 
    <span class="co">#  use a log10 transformed scale</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span>() <span class="op">+</span> 
    <span class="co">#  use a minumal scale with only vertical grid lines</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>(<span class="fl">14</span>) <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(
      axis.title.y = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
      panel.grid.minor = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
      panel.grid.major.y = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>()
    ) <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
      x = <span class="st">"Odds Ratio"</span>,
      size = <span class="st">"Sample Size"</span>
    )
}

<span class="kw">fp</span> <span class="op">&lt;-</span> <span class="fu">forest_plot</span>(<span class="kw">ipi_metaanalysis</span>)

<span class="kw">fp</span>
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">tl_plot</span> <span class="op">&lt;-</span> 
  <span class="kw">mc_ipi</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/summarize_control_quality.html">summarize_control_quality</a></span>(
    <span class="st">"Socio-\ndemo-\ngraphics"</span> = <span class="kw">`Maternal age`</span> <span class="op">&amp;</span> <span class="kw">`Race/ethnicity`</span> <span class="op">&amp;</span> <span class="kw">`Marital status`</span>,
    <span class="st">"Socio-\neconomic\nFactors"</span> = <span class="kw">`SES category`</span> <span class="op">|</span> <span class="kw">Insurance</span> <span class="op">&amp;</span> <span class="kw">Education</span>,
    <span class="st">"Repro-\nductive Hx"</span> = <span class="kw">`Prior pregnancy outcome`</span>
  ) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="kw">ipi_metaanalysis</span>, by = <span class="st">"study"</span>) <span class="op">%&gt;%</span> 
  <span class="fu">sort_by_year</span>() <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(variable = <span class="kw">stringr</span>::<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span>(<span class="kw">variable</span>, <span class="fl">10</span>)) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mc_heatmap.html">mc_trafficlight</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="../reference/geom_cochrane.html">geom_cochrane</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="../reference/scale_fill_cochrane.html">scale_fill_cochrane</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_mc.html">theme_mc</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(legend.position = <span class="st">"right"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(x = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html">guide_axis</a></span>(n.dodge = <span class="fl">2</span>)) <span class="op">+</span> 
  <span class="fu"><a href="../reference/facet_constructs.html">facet_constructs</a></span>()

<span class="kw">tl_plot</span>
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-12-1.png" width="480"></p>
<p>Putting the plots side-by-side is effortless with patchwork:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://patchwork.data-imaginist.com">patchwork</a></span>)

<span class="co"># forest plot</span>
<span class="kw">fp</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(legend.position = <span class="st">"none"</span>) <span class="op">+</span> 
  <span class="co"># traffic light plot</span>
  <span class="kw">tl_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(axis.text.y = <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(), legend.position = <span class="st">"none"</span>) <span class="op">+</span>
  <span class="co"># make the FP thrice as as wide as the TLP</span>
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span>(widths = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">1</span>))
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-13-1.png" width="960"></p>
<div id="using-control-quality-as-an-analytic-category" class="section level2">
<h2 class="hasAnchor">
<a href="#using-control-quality-as-an-analytic-category" class="anchor"></a>Using control quality as an analytic category</h2>
<p>Another use of metaconfoundr is to create categories for which to estimate sub-group summary effect sizes. Let’s use the metafor package to do a simple meta-analysis by whether a study is, overall, adequately controlled, inadequately controlled, or controlled with some concerns.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://www.metafor-project.org">metafor</a></span>)
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; Loading 'metafor' package (version 2.4-0). For an overview </span>
<span class="co">#&gt; and introduction to the package please type: help(metafor).</span>
<span class="kw">ipi_metaanalysis</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="kw">summary_df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">variable</span> <span class="op">==</span> <span class="st">"overall"</span>), by = <span class="st">"study"</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(se = <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="kw">upper_ci</span>) <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="kw">estimate</span>) <span class="op">/</span> <span class="fl">1.96</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">control_quality</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html">group_map</a></span>(<span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/metafor/man/rma.uni.html">rma</a></span>(data = <span class="kw">.x</span>, yi = <span class="kw">estimate</span>, sei = <span class="kw">se</span>)) 
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random-Effects Model (k = 2; tau^2 estimator: REML)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; tau^2 (estimated amount of total heterogeneity): 0 (SE = 0.6059)</span>
<span class="co">#&gt; tau (square root of estimated tau^2 value):      0</span>
<span class="co">#&gt; I^2 (total heterogeneity / total variability):   0.00%</span>
<span class="co">#&gt; H^2 (total variability / sampling variability):  1.00</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Test for Heterogeneity:</span>
<span class="co">#&gt; Q(df = 1) = 0.1867, p-val = 0.6657</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model Results:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; estimate      se    zval    pval   ci.lb   ci.ub </span>
<span class="co">#&gt;   1.5269  0.4309  3.5440  0.0004  0.6825  2.3714  *** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random-Effects Model (k = 13; tau^2 estimator: REML)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; tau^2 (estimated amount of total heterogeneity): 0.0484 (SE = 0.0424)</span>
<span class="co">#&gt; tau (square root of estimated tau^2 value):      0.2199</span>
<span class="co">#&gt; I^2 (total heterogeneity / total variability):   51.70%</span>
<span class="co">#&gt; H^2 (total variability / sampling variability):  2.07</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Test for Heterogeneity:</span>
<span class="co">#&gt; Q(df = 12) = 29.1122, p-val = 0.0038</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model Results:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; estimate      se     zval    pval   ci.lb   ci.ub </span>
<span class="co">#&gt;   1.3093  0.0923  14.1783  &lt;.0001  1.1283  1.4903  *** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
</pre></div>
</div>
</div>
<div id="visualizing-non-confounders" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizing-non-confounders" class="anchor"></a>Visualizing non-confounders</h1>
<p>Many studies control for variables that are not, in fact, confounders. While there are many cases where doing this will not affect results, there are several, such as controlling for a descendant of the exposure and outcome, that may increase bias. By default, metaconfoundr does not plot non-confounders. Instead, there is a set of tools for evaluating how many non-confounders for which a study controls. The more controlled for, the higher the chance that one is inducing bias.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">ipi</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/metaconfoundr().html">metaconfoundr</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/count_non_confounders.html">plot_non_confounders</a></span>(geom = <span class="kw">ggplot2</span>::<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>)
</pre></div>
<p><img src="intro-to-metaconfoundr_files/figure-html/unnamed-chunk-15-1.png" width="480"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Malcolm Barrett, Julie M. Petersen, Ludovic Trinquart.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
